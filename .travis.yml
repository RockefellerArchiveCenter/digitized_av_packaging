dist: bionic
language: python
cache: pip

before_script:
  - pip install tox
  - if [ ${FFMPEG} = true ]; then sudo apt-get update && sudo apt-get install ffmpeg; fi

script: tox

before_deploy:
  - docker build -t ${DOCKER_REPO} .
  - if [ ! -d deploy_scripts ]; then git clone https://github.com/RockefellerArchiveCenter/deploy_scripts.git; fi
deploy:
  provider: script
  script: bash deploy_scripts/containers/push_image_to_ecr.sh
  on:
    branch: base

matrix:
  include:

    - python: "3.10"
      env: 
        - TOXENV=py310
        - FFMPEG=true

    # Linters

    - python: "3.10"
      env: TOXENV=linting

notifications:
  email: false
